<div class="card p-4" *ngIf="title == 'Client Sign Off'">
  <h5>Client sign-off for Job 117660</h5>
  <hr />

  <form [formGroup]="signOffForm">
    <!-- Company Field -->
    <div class="mb-3">
      <label class="form-label text-primary">Company *</label>
      <input type="text" class="form-control" formControlName="company" />
    </div>

    <!-- Load contact button -->
    <div class="mb-3">
      <button
        type="button"
        class="btn btn-primary"
        (click)="loadContactFromJob()"
      >
        Load contact from job
      </button>
    </div>

    <!-- Name Field -->
    <div class="mb-3">
      <label class="form-label">Name *</label>
      <input type="text" class="form-control" formControlName="name" />
    </div>

    <!-- Contact Number -->
    <div class="mb-3">
      <label class="form-label">Contact Number *</label>
      <input type="text" class="form-control" formControlName="contactNumber" />
    </div>

    <!-- Checkboxes -->
    <!-- <div class="form-check">
        <input type="checkbox" class="form-check-input" formControlName="signingEquipment" id="equipment">
        <label class="form-check-label" for="equipment">Signing for equipment</label>
      </div> -->
    <div class="form-check">
      <input
        type="checkbox"
        class="form-check-input"
        formControlName="signingEquipment"
        id="equipment"
      />
      <label class="form-check-label" for="equipment"
        >Signing for equipment</label
      >
    </div>

    <!-- Equipment List -->
    <div *ngIf="signOffForm.get('signingEquipment')?.value" class="mt-2 ms-3">
      <p class="mb-1">
        I acknowledge that the equipment recorded as follows is accurate:
      </p>
      <ul>
        <li *ngFor="let item of equipmentList">
          {{ item.title }} (Quantity: {{ item.quantity }})
        </li>
      </ul>
    </div>
    <!-- Signing for time -->
    <div class="form-check mb-2">
      <input
        type="checkbox"
        class="form-check-input"
        formControlName="signingTime"
        id="time"
      />
      <label class="form-check-label" for="time">Signing for time</label>
    </div>

    <!-- Time Info -->
    <div *ngIf="signOffForm.get('signingTime')?.value" class="ms-3">
      <p class="mb-1">
        I acknowledge that the time recorded as follows is accurate:
      </p>
      <p class="mb-1">Started: {{ updatedTime | date : "fullDate" || "(not started)" }}</p>
      <p class="mb-1">Finished: {{ submitTime | date : "fullDate"  || "(not finished)" }}</p>
      <p>Total hours: {{ timeLog.totalHours }}</p>
    </div>
    <!-- Notes -->
    <div class="mb-3">
      <label class="form-label">Notes *</label>
      <textarea class="form-control" formControlName="notes"></textarea>
    </div>

    <p>
      I acknowledge that this record can be used for invoicing and inventory
      tracking purposes.
    </p>

    <div class="mb-3">
      <label class="form-label text-danger">Sign here: *</label>
      <canvas
        #canvas
        class="signature-canvas"
        ngDefaultControl
        style="touch-action: none; border: solid #e6d2d2 1px"
      ></canvas>
      <!-- <signature-pad [options]="signaturePadOptions" (onEnd)="drawComplete()" #signaturePad></signature-pad> -->
      <!-- <signature-pad [options]="signaturePadOptions" (onBeginEvent)="drawStart()" (onEndEvent)="drawComplete()"></signature-pad> -->
      <!-- <signature-pad [options]="signaturePadOptions" (onEnd)="drawComplete()" #signaturePad></signature-pad> -->
    </div>

    <!-- <div class="text-danger mb-3">* required</div> -->

    <div class="d-flex gap-2">
      <button type="button" class="btn btn-primary" (click)="clearSignature()">
        Clear Signature
      </button>
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancel
      </button>
      <button type="submit" class="btn btn-success" (click)="signOff()">
        Save
      </button>
    </div>
  </form>
</div>

<div *ngIf="title == 'view'">
  <div class="card shadow rounded mt-3" id="print-section">
  <div class="card-header bg-white border-0">
    <h5 class="mb-0">Client sign-off for Job {{ clientSignOf.jobId }}</h5>
  </div>
  <div class="card-body">
    <h6 class="fw-bold">Client sign-off submitted</h6>

    <p><strong>Client Company:</strong> {{ clientSignOf.company }}</p>
    <p><strong>Client Name:</strong> {{contact.name}}</p>
    <p><strong>Client Phone:</strong> {{contact.contactNumber}}</p>

    <p *ngIf="clientSignOf.signingForEquipment == true">I acknowledge that the equipment recorded as follows is accurate:</p>

    <ul *ngIf="clientSignOf.signingForEquipment == true">
      <li *ngFor="let item of equipmentList">
        {{ item.title }} (Quantity: {{ item.quantity }})
      </li>
    </ul>

     <p *ngIf="clientSignOf.signingForTime == true">I acknowledge that the time recorded as follows is accurate:</p>

    <ul *ngIf="clientSignOf.signingForTime == true">
    <p>Started: {{timeLog.started |  date : "fullDate" }}</p>
    <p>Finished: {{timeLog.finished |  date : "fullDate" }}</p>
    <p>Total Hours: {{timeLog.totalHours }}</p>
    </ul>

    <p><strong>Notes:</strong> {{ clientSignOf.notes }}</p>

    <p>
      I acknowledge that this record can be used for invoicing and inventory
      tracking purposes.
    </p>

    <div class="mb-3">
      <img
        [src]="clientSignOf.signature"
        alt="Signature"
        class="img-fluid border rounded"
        style="max-width: 250px"
      />
    </div>

    <p class="text-muted">
      Submitted at {{ clientSignOf.timestamp | date : "shortTime" }} on
      {{ clientSignOf.timestamp | date : "dd/MM/YYYY" }}
    </p>

    
  </div>
</div>
<div class="d-flex gap-2">
      <button class="btn btn-secondary"  (click)="cancel()">Cancel</button>
      <button class="btn btn-primary" (click)="printPage()">Print</button>
    </div>
    </div>
